<!doctype html>
<html>
  <head>
    <title>Share two numbers</title>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.2/socket.io.js"></script>
    <script src="cryptico.min.js"></script>
    <script src="jiff.js"></script>
  </head>
  <body>
    <ul id="received_shares"></ul>

    <script>
    // Setup
    var jiff_instance = null;
    var parties = 3;

    $(function() {
      jiff_instance = make_jiff("http://localhost", 3000, '1', parties);
      console.log(jiff_instance);
    });

    // MPC CODE
    function mpc() {
      if(jiff_instance == null || !jiff_instance.ready) { alert("Please wait!"); return; }
      var number = parseInt($('#m').val());

      var shares = jiff_instance.share(number);
      var sum = shares[1];

      for(var i = 2; i <= parties; i++) {
        sum = sum.add(shares[i]);
      }

      sum.open(output, error);
    }

    // Show output
    function output(result) {
      $("#received_shares").append("<li>" + result + "</li>");
    }

    // Show error
    function error(s) {
      console.log("ERROR "  + s);
      $("#received_shares").append("<li> error </li>");
    }
    </script>

    <form action="" onsubmit="return false;">
      <input id="m" autocomplete="off" /> <input type="submit" onClick="mpc();" value="Share and Sum" />
    </form>
  </body>
</html>
