<!doctype html>
<html>
  <head>
    <title>Share two numbers</title>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.2/socket.io.js"></script>
    <script src="jiff.js"></script>
  </head>
  <body>
    <ul id="received_shares"></ul>
    
    <script>
    // Setup
    var jiff_instance = null;
    var parties = 2;
    
    $(function() {
      jiff_instance = make_jiff("http://localhost", 3000, parties);
      console.log(jiff_instance);
    });
    
    /*
     * MPC CODE
     */
    
    // Share the inputs
    function begin_mpc() {
      if(jiff_instance == null || !jiff_instance.ready) { 
        alert("Please wait!"); 
        return; 
      }
      
      number = parseInt($('#m').val());
      jiff_instance.share(number).then(sum_shares, error);
    }
    
    // Sum and open the shares
    function sum_shares(shares) {
      var sum = 0;
      for(var i = 1; i <= parties; i++) {
        sum = (sum + shares[i].value) % mod;
      }
      
      jiff_instance.open(new secret_share(jiff_instance, sum)).then(output, error);
    }
    
    // Show output
    function output(result) {
      $("#received_shares").append("<li>" + result + "</li>");
    }
    
    // Show error
    function error(s) {
      console.log("ERROR "  + s);
      $("#received_shares").append("<li> error </li>");
    }
    </script>
    
    <form action="" onsubmit="return false;">
      <input id="m" autocomplete="off" /> <input type="submit" onClick="begin_mpc();" value="Share and Sum" />
    </form>
  </body>
</html>
