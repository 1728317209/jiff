var jiff_instance;

var data_0 = [
    -3.4309652228725955,
    -6.227851916645306,
    3.818002409527967,
    -1.6779891653459835,
    3.1477818984959853,
    2.5876622236792928,
    5.050509092388616,
    -4.562471620800639,
    -2.224155339070439,
    -0.7264816704062784,
    1.5410361005491517,
    4.054170575004008,
    -2.7772003505418055,
    -5.782014303848904,
    -0.7588615425603148,
    3.9849583145248366,
    2.0567742549370074,
    0.778215895305076,
    -0.33669528500586976,
    -2.484947119306727,
    -0.5507193214375158,
    -1.8931221188262004,
    0.4037040225469505,
    -0.8137736689801605,
    -2.850321540078924,
    -1.022203131595037,
    0.9886555128411598,
    -3.144219164967701,
    0.761306587078646,
    -1.5018842231981,
    -2.207969707595229,
    -1.0648194645643283,
    0.6226362164828798,
    -0.6241010153638061,
    0.3712790861024041,
    -0.6977975157278445,
    0.10278043425024969,
    1.6219661506851484,
    2.928039962489822,
    0.6587881686664036,
    -1.2434222824728762,
    0.09708361323675352,
    2.159021342305599,
    -0.2585965469289878,
    1.641740878975841,
    -1.0151280954613835,
    -1.948352343787231,
    -1.5687573797612944,
    1.3186157793261688,
    -2.5980108015932504,
    0.8558614096387116,
    1.6907436954947486,
    1.0572276100753213,
    -1.1565980998173881,
    -0.20341589043220576,
    -1.9369997087149715,
    -0.6639050619363279,
    0.05277439861904357,
    -2.213186661743752,
    -2.0155487333185214,
    -1.07137828329203,
    0.07170923874871422,
    -0.8758111975930291,
    0.3095792630999342,
    1.151179437951033,
    -0.6865399186206576,
    -0.07482605942218765,
    -0.3398853128562941,
    1.512237643813157,
    0.4150595307950075,
    -0.09554109269865094,
    0.2720267110897898,
    -0.6849084214248178,
    0.9935975386739008,
    0.34797895115839816,
    0.15377939446096278,
    0.42056245565189876,
    -0.21846247897611704,
    -0.21515473332188795,
    -1.6724424188209381,
    0.5858588451886069,
    0.18317988099607005,
    -0.28871903337033544,
    0.5213064150058528,
    -1.7706422782696742,
    -0.8629225325656009,
    0.36010422676503157,
    -1.1271557429653987,
    -0.696652606098883,
    0.8099628401186825,
    0.2646249686700409,
    0.09692846971669944,
    1.323774573405115,
    -0.28817587137346345,
    -0.03159426995976663,
    -0.26686394105793354,
    -0.2659854484743588,
    0.5060169030729601,
    -0.4289024012577377,
    -0.17195561972018292,
    0.5335098157798412,
    0.46101262816503624,
    -0.10559587220599997,
    -0.13734493750984927,
    0.070758918334202,
    1.2537253790015763,
    -0.060575023399293215,
    0.29092740549851526,
    -0.4958240198545606,
    -0.47296133652288275,
    -1.0920423189616653,
    -0.7512812130521802,
    -0.7870605844887195,
    -1.2340539960580998,
    0.49279689859811454,
    0.8826489130480253,
    -0.8174923642662715,
    0.8218607808243664,
    -0.21109440905874188,
    0.2764145262120886,
    0.36567347012154533,
    0.8181834497404413,
    -0.742416062327279,
    -0.5795830431466281,
    0.3430958124814188,
    -0.0002727471322149788,
    0.3723993678998516,
    0.4768740781706911,
    -0.5412992385608626,
    -0.7249507399646987,
    -0.8318390937850173,
    -0.3291214975445874,
    -0.5571821773751902,
    0.037727959332230554,
    -0.41173241033764973,
    0.6783225177991716,
    -1.7453498843290092,
    0.22384094353883832,
    0.4242634865010473,
    0.19444716204193133,
    -0.07337562962870636,
    0.9263388629290089,
    -0.07809252406832579,
    0.6083685698917165,
    -0.13906096505050997,
    0.23365216188381466,
    0.10795315737537617,
    0.22358598267774088,
    -0.16546515057022326,
    -0.2881514223744724,
    -0.6369734904890789,
    0.025275902851604637,
    0.5966669315303734,
    0.6322042580220814,
    0.3239492200830655,
    -0.07927598651663342,
    0.35592627212100303,
    -0.6748028782224644,
    -0.7983201349225698,
    0.5879042819367667,
    0.7491598141749722,
    -0.10355466308033096,
    -0.24198623524437254,
    -0.055341779959294485,
    0.3325699206116214,
    0.093962885729392,
    -0.5106422319598987,
    -0.5234283924139923,
    -0.03863710881572413,
    0.07071646537675388,
    1.0921138371911745,
    -0.23160080660802423,
    -1.5393699299683452,
    0.6996500426742988,
    -0.6886281240132048,
    0.7826051693021431,
    -0.21525038127228902,
    -0.12309240831855184,
    0.8389080106537434,
    -0.20855913344955357,
    0.3930205540754115,
    0.2978801201718659,
    0.10226842398537443,
    0.006728861428248134,
    0.48977845927976327,
    0.18020028486833267,
    -0.055964824546459124,
    -0.0903089294930661,
    -0.77067656725199,
    0.1876589677527382,
    0.3227972012929185,
    0.23713712577113863,
    -0.38753118760253386,
    0.15537099785040187,
    -0.6032856717018461,
    -0.27370812152876856,
    0.06135004610527042,
    -0.18184664682093235,
    -0.2570818316504207,
    -0.011870452927817438,
    -0.5267157698621211,
    0.29980437947788474,
    0.5479129424007922,
    0.5261389894921771,
    -0.05475109512363269,
    0.10121778683940583,
    0.006889858106080976,
    -0.3249561928846034,
    -0.6487811365054644,
    -1.000043713682102,
    -0.07043138443610535,
    -0.5510993939680544,
    -0.2793219468970643,
    0.49784880478798954,
    0.44459630439757836,
    0.27087120804325354,
    0.5848381362357457,
    0.3003961206639898,
    -0.23867987371145127,
    0.46965820256874935,
    -0.10064824394222852,
    -0.27164931224906863,
    -0.5880723006172014,
    -0.20546273801050996,
    -0.20454687819486478,
    -0.09627803719252062,
    -0.22256255114826692,
    0.23600829011619906,
    0.3352465136870653,
    -0.25234443398207074,
    0.04137689702545831,
    0.5083381934176792,
    -0.8490114529950392,
    0.09250399881322283,
    -0.6547795653134648,
    -0.09147459946692904,
    -0.06323979473860938,
    -0.28398313190919555,
    0.046413740304482955,
    -0.14982153496068343,
    -0.5102857450101665,
    0.47606068704706794,
    0.4653522155166981,
    -0.4483451848007863,
    -0.01870866642319785,
    -0.11570691804681477,
    -0.0018427979101487205,
    -0.2987314067900515,
    0.43185428977386364,
    0.37809958991856657,
    0.11166778718119572,
    0.445776102485779,
    0.3493013925601264,
    -0.1089888541636087,
    -0.4121108329331184,
    -0.006656802695800549,
    -0.13128841779538017,
    0.28510701616231454,
    -0.23189798978613932,
    0.11877191984494312,
    0.508842264494329,
    -0.14028165238474358,
    0.16759646592797714,
    0.4559586824161303,
    -0.4878819636097119,
    0.5764344843202047,
    0.19510602276895234,
    -0.2939755742256637,
    -0.47040909446398227,
    -0.4758597499995392,
    0.22000481356655474,
    0.4190655190866529,
    -0.3833007016511819,
    0.12808071085178543,
    0.25017560567783775,
    -0.1003036282783288,
    -0.2603939704416709,
    -0.7151573112679411,
    0.2207681094721068,
    -0.011524632805755785,
    -0.4334322289873249,
    -0.1096654422844688,
    -0.08401117531338086,
    -0.5113361597586931,
    0.47361746728000437,
    0.2990007226010587,
    0.13207012249699746,
    -0.19623653122644144,
    -0.40408050780158045,
    -0.18705672324373815,
    0.028894982939576375,
    0.12708476368625102,
    -0.8809693075356329,
    -0.47972563588973627,
    -0.3562584393433863,
    0.13749208406046798,
    -0.21002025975084104,
    0.09040607510154802,
    -0.16552357435740733,
    0.14325388620687088,
    0.35442757520332424,
    -0.1726239095476928,
    -0.22934269443012686,
    -0.4528088265644361,
    0.18409297756737592,
    0.026648771992598692,
    -0.5159530338911336,
    0.1696955416156782,
    0.13769539055044216,
    0.42995634441406483,
    0.1408667421545971,
    -0.22721985685973048,
    0.19120876126409436,
    0.11119122013786326,
    -0.22870374972844204,
    0.0580646497866624,
    0.013623066627004979,
    -0.26908035123096374,
    0.2003141314937223,
    -0.017323505450536885,
    -0.03458815857423928,
    0.0422031404226874,
    0.14402666470678904,
    -0.33048790698544855,
    0.19047782205220348,
    -0.010124641326448566,
    0.039439087714144755,
    0.16015871445117352,
    0.1651954102749323,
    -0.3369483229012623]

// var options = {party_count: 2};
// options.onConnect = function() {
//   var shares = jiff_instance.share(3);
//   var sum = shares[1];
//   for(var i = 2; i <= jiff_instance.party_count; i++)
//     sum = sum.sadd(shares[i]);
//   sum.open(function(v) { console.log(v); jiff_instance.disconnect(); });
// }

// jiff_instance = require('../../lib/jiff-client').make_jiff("http://localhost:8080", 'test-neural-net', options);

// Called when the connect button is clicked: connect to the server and intialize the MPC.
function connect() {
  // Disable connect button
  $('#connectBtn').prop('disabled', true);

  var options = { 'party_count': 2, Zp: new BigNumber(32416190071)  };
  options.onError = function(error) { $("#result").append("<p class='error'>"+error+"</p>"); };
  options.onConnect = function() { $("#computeBtn").attr("disabled", false); $("#output").append("<p>All parties Connected!</p>"); };

  jiff_instance = jiff.make_jiff("http://localhost:8080", "test-neural-net", options);
  jiff_instance = jiff_bignumber.make_jiff(jiff_instance, options)
  jiff_instance = jiff_fixedpoint.make_jiff(jiff_instance, { digits: 4 }); // Max bits after decimal
}

function success(result) { 
    console.log("success, result = " + result);
    return result;
  }

  function test_result(result) { 
    var formattedResult = "[" + result[0] + ", " + result[1] + ", " + result[2] + "]";
    handleResult(formattedResult);
  }

  function failure(error){
    console.error("failure, error = " + error);
  }
  function handleResult(result) {
        $("#output").append("<p>Result is: " + result + "</p>");
        $("#computeButton").attr("disabled", false);
      }

function compute() {
	console.log("in compute")
	for(index in data_0){
                data_0[index] = data_0[index].toFixed(4)
                console.log(data_0[index])
            }
	var results = [];
    var shares_2d = jiff_instance.share_vec(data_0);

    for(var i = 0; i < shares_2d.length; i++) {
      var shares = shares_2d[i];

      var sum = shares[1];

      for(var j = 2; j <= 2; j++) {
        sum = sum.sadd(shares[j]);
      }
      //console.log(sum.open());
      results.push(sum.open().then(success, failure));
    }



    Promise.all(results).then(test_result, failure);  
}
