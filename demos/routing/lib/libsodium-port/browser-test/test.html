<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  </head>

  <body style="font-size: 10pt;">
  <div id="output"> </div>

  <script src="../../../node_modules/bn.js/lib/bn.js"></script>
  <script src="../../../static/sodium-wrappers-sumo.js"></script>
  <script src="../../../static/elliptic.js"></script>
  <script src="../../../lib/libsodium-port/wrapper.js"></script>

  <script type="text/javascript">
    var result = '';
    // Code
    mySodiumWrapper.ready.then(function () {
      // Hash
      var point1 = mySodiumWrapper.hashToPoint('hello1');
      result += 'hash1: ' + point1.join(',') + '<br>';

      var point2 = mySodiumWrapper.hashToPoint('hello2');
      result += 'hash2: ' + point2.join(',') + '<br>';

      // Add
      var pointAdd = mySodiumWrapper.pointAdd(point1, point2);
      result += 'add: ' + pointAdd.join(',') + '<br>';

      // Sub
      var pointSub = mySodiumWrapper.pointAdd(pointAdd, point2);
      result += 'sub: ' + pointSub.join(',') + '<br>';

      // Scalar Mult
      var scalar = new BN(2032);
      scalar = mySodiumWrapper.BNToBytes(scalar);

      var pointMult = mySodiumWrapper.scalarMult(point1, scalar);
      result += 'mult: ' + pointMult.join(',');

      document.getElementById('output').innerHTML = result;
    });


    function verify() {
      var ver = document.getElementById('textArea').value.trim();
      document.getElementById('textArea').value = ver;

      var vers = ver.split('\n');
      var ress = result.split('<br>');

      if (vers.length !== ress.length) {
        alert('Number of rows mismatch!');
        return;
      }

      var mismatches = [];
      for (var i = 0; i < vers.length; i++) {
        if (vers[i].trim() !== ress[i].trim()) {
          mismatches.push(i+1);
        }
      }

      if (mismatches.length === 0) {
        alert('OK!');
      } else {
        alert('Mismatches in ' + mismatches.toString());
      }
    }
  </script>

  <br><br>
  <textarea id="textArea" rows="7" cols="150" placeholder="Copy result from terminal"></textarea>
  <br>
  <input type="button" value="Verify!" onclick="verify();">
  </body>
</html>
