<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
  </head>
  <body style="width:100%; height:100%; margin:0; padding:0;">
	<div id="leaflet" style="width:100vw; height:100vh;"></div>
  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous">
  </script>

	<script>
    $( document ).ready(function() {
     console.log( "ready!" );
     document.getElementById('leaflet').style.cursor = 'crosshair';
    });
    var obj = {

      "features": [
        {'type': 'Point', 'coordinates': [-71.0683,42.3514], 'properties':{'point_id': 0}} ,
        {'type': 'Point', 'coordinates': [-71.0683,42.3516], 'properties':{'point_id': 1}} ,
        {'type': 'Point', 'coordinates': [-71.0684,42.3516], 'properties':{'point_id': 2}} ,
        {'type': 'Point', 'coordinates': [-71.0669,42.3510], 'properties':{'point_id': 3}} ,
        {'type': 'Point', 'coordinates': [-71.0672,42.3518], 'properties':{'point_id': 4}} ,
        {'type': 'Point', 'coordinates': [-71.0676,42.3528], 'properties':{'point_id': 5}} ,
        {'type': 'Point', 'coordinates': [-71.0649,42.3510], 'properties':{'point_id': 6}} ,
        {'type': 'Point', 'coordinates': [-71.0647,42.3517], 'properties':{'point_id': 7}} ,
        {'type': 'Point', 'coordinates': [-71.0647,42.3516], 'properties':{'point_id': 8}} ,
        {'type': 'Point', 'coordinates': [-71.0685,42.3545], 'properties':{'point_id': 9}} ,
        {'type': 'Point', 'coordinates': [-71.0690,42.3554], 'properties':{'point_id': 10}} ,
        {'type': 'Point', 'coordinates': [-71.0694,42.3562], 'properties':{'point_id': 11}} ,
        {'type': 'Point', 'coordinates': [-71.0697,42.3566], 'properties':{'point_id': 12}} ,
        {'type': 'Point', 'coordinates': [-71.0698,42.3570], 'properties':{'point_id': 13}} ,
        {'type': 'Point', 'coordinates': [-71.0678,42.3571], 'properties':{'point_id': 14}} ,
        {'type': 'Point', 'coordinates': [-71.0676,42.3565], 'properties':{'point_id': 15}} ,
        {'type': 'Point', 'coordinates': [-71.0657,42.3570], 'properties':{'point_id': 16}} ,
        {'type': 'Point', 'coordinates': [-71.0690,42.3562], 'properties':{'point_id': 17}} ,
        {'type': 'Point', 'coordinates': [-71.0679,42.3574], 'properties':{'point_id': 18}} ,
        {'type': 'Point', 'coordinates': [-71.0682,42.3573], 'properties':{'point_id': 19}} ,
        {'type': 'Point', 'coordinates': [-71.0694,42.3570], 'properties':{'point_id': 20}} ,
        {'type': 'Point', 'coordinates': [-71.0661,42.3578], 'properties':{'point_id': 21}} ,
        {'type': 'Point', 'coordinates': [-71.0650,42.3580], 'properties':{'point_id': 22}} ,
        {'type': 'Point', 'coordinates': [-71.0650,42.3576], 'properties':{'point_id': 23}} ,
        {'type': 'Point', 'coordinates': [-71.0650,42.3571], 'properties':{'point_id': 24}} ,
        {'type': 'Point', 'coordinates': [-71.0645,42.3523], 'properties':{'point_id': 25}} ,
        {'type': 'Point', 'coordinates': [-71.0629,42.3556], 'properties':{'point_id': 26}} ,
        {'type': 'Point', 'coordinates': [-71.0633,42.3551], 'properties':{'point_id': 27}} ,
        {'type': 'Point', 'coordinates': [-71.0644,42.3526], 'properties':{'point_id': 28}} ,
        {'type': 'Point', 'coordinates': [-71.0626,42.3548], 'properties':{'point_id': 29}} ,
        {'type': 'Point', 'coordinates': [-71.0614,42.3531], 'properties':{'point_id': 30}} ,
        {'type': 'Point', 'coordinates': [-71.0612,42.3547], 'properties':{'point_id': 31}} ,
        {'type': 'Point', 'coordinates': [-71.0632,42.3577], 'properties':{'point_id': 32}} ,
        {'type': 'Point', 'coordinates': [-71.0620,42.3565], 'properties':{'point_id': 33}} ,
        {'type': 'Point', 'coordinates': [-71.0662,42.3583], 'properties':{'point_id': 34}} ,
        {'type': 'Point', 'coordinates': [-71.0665,42.3510], 'properties':{'point_id': 35}} ,
        {'type': 'Point', 'coordinates': [-71.0650,42.3583], 'properties':{'point_id': 36}} ,
        {'type': 'Point', 'coordinates': [-71.0619,42.3565], 'properties':{'point_id': 37}} ,
        {'type': 'Point', 'coordinates': [-71.0617,42.3543], 'properties':{'point_id': 38}} ,
        {'type': 'Point', 'coordinates': [-71.0613,42.3534], 'properties':{'point_id': 39}}
      ],
      "type": "geoql"
    }
 
  </script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
	<script>
      var pointCount = 0
      function randomColor() {
        var color = '', letters = '0123456'; //789ABCDEF
        for (var i=0; i<6; i++) {color += letters[Math.floor(Math.random() * letters.length)];}
        return '#' + color;
      }

      function drawLineBetweenPoints(start,stop){
        //start and stop are strng arrays containng start and stop latlns respectively
        var latlngs = Array();
        latlngs.push(start);
        latlngs.push(stop);
        // latlngs.push([parseFloat(start.split(",")[0]), parseFloat(start.split(",")[1])])
        // latlngs.push([parseFloat(stop.split(",")[0]), parseFloat(stop.split(",")[1])])
        var polyline = L.polyline(latlngs, {color: 'midnightblue'}).addTo(leaflet);
        //Optional, enable for zooming in on the map area with line
        //leaflet.fitBounds(polyline.getBounds());

      }

      function drawPath(points){
        for(jump in points){
          jump = parseInt(jump);
          if(jump < points.length-1){
            source = obj["features"][points[jump]]["coordinates"].slice().reverse();
            dest = obj["features"][points[jump+1]]["coordinates"].slice().reverse();
            drawLineBetweenPoints(source,dest)
          }
          console.log(points[jump]);
        }
      }
      var leaflet = L.map('leaflet').setView([42.35439273125373, -71.06362542969399], 15);
      L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom:20, attribution:'', id:'mapbox.light'
      }).addTo(leaflet);
      function onEachFeature(feature, layer) {
        // if (feature.properties) {
          var popupContent = " Helllo!<p>" + feature.coordinates[0] + '-' + feature.coordinates[1] + ".</p>";
          layer.bindPopup(popupContent);
        }
      L.geoJson(obj, {
        filter: function (feature, layer) { return true; },
        onEachFeature: onEachFeature,
        style: function (feature) { return {"color": randomColor()}; },
        pointToLayer:
          function (feature, latlng) {
            var circle = L.circleMarker(latlng, {radius:4, weight:0.1, fillColor:"#6666AA", color:"#6666AA", opacity:1, fillOpacity:1});
            circle.on('mouseover', function(){
              circle.setStyle({ color: 'red' });
            });
            circle.on('click', function(){
              lat = circle._latlng["lat"];
              lng = circle._latlng["lng"]
              console.log(circle);         
              var marker = L.marker([lat, lng]).addTo(leaflet);
              if(pointCount == 0){
                window.localStorage.setItem("StartLatLng",[lat,lng]);
                window.localStorage.setItem("StartPointId", circle.feature.geometry.properties["point_id"]);
              }else{
                window.localStorage.setItem("StopPointId", circle.feature.geometry.properties["point_id"]);
                window.localStorage.setItem("StopLatLng",[lat,lng]);

                // //make ajax call to server
                      $.ajax({
                        type: 'GET',
                        url: 'http://localhost:9115/calculate/1,3',
                        datatype: 'json',
                        success: function (data) {
                          //drawLines between points
                          drawPath(data["result"]);                
                        },
                        error: function (request, status, error) {
                          console.log(error);
                        }
                      });
              }
              // pointCount == 0 ? window.localStorage.setItem("Start",[lat,lng]):window.localStorage.setItem("Stop",[lat,lng]);
              pointCount++;
              // circle.openPopup(latlng);
            });
            return circle;
          }
      }).addTo(leaflet);
	</script>
  </body>
</html>