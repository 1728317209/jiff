<!doctype html>
<html>
  <head>
    <title>Test the secret sharing</title>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.2/socket.io.js"></script>
    <script src="../jiff.js"></script>
  </head>
  <body>
    <script>
      var parties = 3;
      var tests = [
          [2, 3]
      ];
    </script>
  
  
    <div id="result"></div>
    <ul id="details"></ul>

    <script>    
    // run all tests
    function test() {
      var ok = true;
      
      for(var i = 0; i < tests.length; i++) 
        ok = single_test(i) && ok;

      
      if(!ok) $("#result").append("<font color='red'>Failed</font>");
      else $("#result").append("<font color='green'>Success</font>");
    }
    
    // run test case at index
    function single_test(index) {
      var numbers = tests[index];
      
      var map1 = jiff_compute_shares(numbers[0], parties);
      var map2 = jiff_compute_shares(numbers[1], parties);
      
      var map = {};
      var final_share_party = { 1: {}, 2: {}, 3: {} }
      
      for(var i = 1; i <= parties; i++) {
        map[i] = map1[i] * map2[i];
      }
           
      
      for(var i = 1; i <= parties; i++) {
        var tmp = jiff_compute_shares(map[i], parties);
        for(var j = 1; j <= parties; j++) {
          final_share_party[i][j] = tmp[j];
        }
      }
      
      map = {};
      for(var i = 1; i <= parties; i++) {
        map[i] = jiff_lagrange(final_share_party[i], parties);
      } 
      
      var value = jiff_lagrange(map, parties);
      var actual = (numbers[0] * numbers[1]) % Zp;
      
      if(value == actual || actual == value + Zp) return true;      
      $("#details").append("<li> prod("+numbers.toString()+") = "+(numbers[0]*numbers[1])+" => open = "+value+"</li>");
      return false;
    }
    </script>

    <button onClick="test();">Start</button>
  </body>
</html>
