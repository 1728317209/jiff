<html>
  <head>
    <title>Sum numbers under MPC</title>
    
    <style>
      .error {
        color: #FF0000;
      }
    </style>
    
    <!-- jiff and required libraries -->
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.2/socket.io.js"></script>
    <script src="jiff-client/cryptico.min.js"></script>
    <script src="jiff-client/jiff.js"></script>
    
    <script type="text/javascript">
      var jiff_instance;
      
      function connect() {
        var computation_id = $('#computation_id').val();
        var party_count = parseInt($('#count').val());
        
        if(isNaN(party_count))
          $("#output").append("<p class='error'>Party count must be a valid number!</p>");
        
        else {
          var options = { party_count: party_count};
          options.onError = function(error) { $("#output").append("<p class='error'>"+error+"</p>"); };
          options.onConnect = function() { $("#output").append("<p>All parties Connected!</p>"); };
          
          jiff_instance = jiff.make_jiff("localhost:3000", computation_id, options);
          $("#sumButton").attr("disabled", false);
        }
      }
    
      function sum() {
        var input = parseInt($("#number").val());

        if(isNaN(input))
          $("#output").append("<p class='error'>Input a valid number!</p>");
        else if(input > gZp)
          $("#output").append("<p class='error'>Input a number less than "+gZp+"!</p>");
        else if(jiff_instance == null || !jiff_instance.ready)
          alert("Please wait!");
        else
          MPC(input);
      }
      
      function MPC(input) {
        $("#output").append("<p>Starting...</p>");
        var shares = jiff_instance.share(input);
        
        var sum = shares[1];
        for(var i = 2; i <= jiff_instance.party_count; i++)
          sum = sum.add(shares[i]);
          
        sum.open(handleResult);          
      }
      
      function handleResult(result) {
        $("#output").append("<p>Result is: " + result + "</p>");
      }
    </script>
  </head>
  
  <body>
    <h1>Connect JIFF</h1>
    <label for="computation_id">Computation ID</label><input id="computation_id" value="test-sum"></input> <br><br>
    <label for="count">Party Count<label> <input id="count" pattern="[0-9]*"> &nbsp; <button onclick="connect();">Connect</button>
    <br> <br>
    
    <hr>

    <h1>Sum Numbers under MPC</h1>
    <label for="number">Input Number</label> <input id="number" pattern="[0-9]+"> &nbsp; <button onclick="sum();" disabled="disabled" id="sumButton">Sum</button> <br>
    <div id="output"> </div>
  </body>
</html>
